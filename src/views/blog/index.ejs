<!doctype html>
<html lang="en">
<head>
  <%- include('../partials/head', { title: (title || 'Blog') }) %>
  <meta name="description" content="News, stories and updates from Jay Mahalaxmi Match Industries.">
  <style>
    /* ===== Layout (unchanged) ===== */
    .blog-hero{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;align-items:stretch}
    .blog-hero .hero-media{border-radius:14px;overflow:hidden;background:#000}
    .blog-hero img{width:100%;height:100%;object-fit:cover;display:block}
    .blog-hero .hero-text{display:flex;flex-direction:column;gap:10px}
    .blog-hero .meta{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .blog-hero .meta .tag{padding:.25rem .6rem;border:1px solid var(--line,rgba(255,255,255,.15));border-radius:999px;font-size:.85rem;opacity:.9}
    .blog-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}
    .blog-card{display:flex;flex-direction:column}
    .blog-card .thumb{border-radius:12px;overflow:hidden;background:#000;aspect-ratio:16/9;margin:-18px -18px 12px -18px}
    .blog-card img{width:100%;height:100%;object-fit:cover;display:block}
    .blog-card .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .blog-card .tag{padding:.25rem .55rem;border:1px solid var(--line,rgba(255,255,255,.15));border-radius:999px;font-size:.8rem;opacity:.9}
    .blog-sidebar{position:sticky;top:80px}
    .clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
    @media(max-width:980px){
      .blog-hero{grid-template-columns:1fr}
      .blog-grid{grid-template-columns:1fr 1fr}
    }
    @media(max-width:680px){ .blog-grid{grid-template-columns:1fr} }

    /* ===== Palettes (3 different styles) ===== */
    :root{
      /* Grid card title colors (lilac/purple) */
      --grid-link:    #8168e4;
      --grid-hover:   #7157da;
      --grid-visited: #8168e4;

      /* Sidebar "Recent posts" (cyan) */
      --recent-link:   #e9e9e9;
      --recent-hover:  #ffffff;
      --recent-visited:#ffffff;

      /* Featured hero title (sky) */
      --hero-link:    #7dd3fc;
      --hero-hover:   #38bdf8;
      --hero-visited: #a5f3fc;

      /* Shared/aux */
      --skyLine: rgba(125,211,252,.35); /* borders */

      /* NEW: Blue CTA just for read-more buttons in the grid */
      --cta-blue:       #60a5fa; /* normal */
      --cta-blue-hover: #3b82f6; /* hover  */
    }

    /* Grid cards only (borders, subtles) */
    .blog-grid .blog-card{ border-color: var(--skyLine) !important; }
    .blog-grid .blog-card .text-sub{ color:#a8c8db !important; }
    .blog-grid .blog-card .tag{ border-color: var(--skyLine) !important; color:#bae6fd !important; }
    .blog-grid .blog-card .thumb{ box-shadow:0 0 0 1px var(--skyLine) inset; }

    /* === 1) Grid card titles === */
    .blog-grid .blog-card h3 a:link,
    .blog-grid .blog-card h3 a:visited{
      color: var(--grid-link) !important;
      text-decoration-color: color-mix(in srgb, var(--grid-link) 60%, transparent);
      text-underline-offset: 2px;
    }
    .blog-grid .blog-card h3 a:hover,
    .blog-grid .blog-card h3 a:focus-visible{
      color: var(--grid-hover) !important;
      text-decoration-color: var(--grid-hover) !important;
      outline: 0;
    }
    .blog-grid .blog-card h3 a:visited{ color: var(--grid-visited) !important; }

    /* === 2) Sidebar "Recent posts" === */
    .blog-sidebar a:link,
    .blog-sidebar a:visited{
      color: var(--recent-link) !important;
      text-decoration-color: color-mix(in srgb, var(--recent-link) 60%, transparent);
      text-underline-offset: 2px;
    }
    .blog-sidebar a:hover,
    .blog-sidebar a:focus-visible{
      color: var(--recent-hover) !important;
      text-decoration-color: var(--recent-hover) !important;
      outline: 0;
    }
    .blog-sidebar a:visited{ color: var(--recent-visited) !important; }

    /* === 3) Featured hero title === */
    .blog-hero h2 a:link,
    .blog-hero h2 a:visited{
      color: var(--hero-link) !important;
      text-decoration-color: color-mix(in srgb, var(--hero-link) 60%, transparent) !important;
      text-underline-offset: 2px;
      text-decoration-thickness: 2px;
    }
    .blog-hero h2 a:hover,
    .blog-hero h2 a:focus-visible{
      color: var(--hero-hover) !important;
      text-decoration-color: var(--hero-hover) !important;
      outline: 0;
    }
    .blog-hero h2 a:visited{ color: var(--hero-visited) !important; }

    /* === NEW: Blue "Read more" buttons only in the grid === */
    .blog-grid .blog-card .btn-outline,
    .blog-grid .blog-card a.btn-outline:link,
    .blog-grid .blog-card a.btn-outline:visited{
      border-color: var(--cta-blue) !important;
      color: var(--cta-blue) !important;
    }
    .blog-grid .blog-card .btn-outline:hover,
    .blog-grid .blog-card a.btn-outline:hover,
    .blog-grid .blog-card a.btn-outline:focus-visible{
      background: color-mix(in srgb, var(--cta-blue) 15%, transparent) !important;
      border-color: var(--cta-blue-hover) !important;
      color: var(--cta-blue-hover) !important;
      outline: 0;
    }
  </style>
</head>
<body>
  <%- include('../partials/header') %>

  <main class="container section">
    <header style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:16px">
      <h1 style="margin:0">Blog</h1>

      <!-- Search -->
      <form action="/blog" method="get" class="contact" style="display:flex;gap:8px;align-items:center">
        <input class="input" type="search" name="q" value="<%= q || '' %>" placeholder="Search articlesâ€¦" style="min-width:220px">
        <% if (tag) { %><input type="hidden" name="tag" value="<%= tag %>"><% } %>
        <button class="btn-outline" type="submit">Search</button>
      </form>
    </header>

    <!-- Tags row -->
    <% if (Array.isArray(tags) && tags.length) { %>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px">
        <a class="btn-outline <%= !tag ? 'active' : '' %>" href="/blog">All</a>
        <% tags.forEach(t => { %>
          <a class="btn-outline <%= (tag===t.slug?'active':'') %>" href="/blog?tag=<%= encodeURIComponent(t.slug) %>"><%= t.name %></a>
        <% }) %>
      </div>
    <% } %>

    <!-- Featured -->
    <section class="card" style="padding:18px;margin-bottom:20px">
      <div class="blog-hero">
        <div class="hero-media">
          <a href="/blog/<%= featured?.slug %>">
            <img src="<%= featured?.image || '/img/blog-placeholder.jpg' %>"
                 alt="<%= featured?.title %>"
                 onerror="this.src='/img/blog-placeholder.jpg'">
          </a>
        </div>
        <div class="hero-text">
          <div class="meta">
            <% if (featured?.tag_name) { %><span class="tag"><%= featured.tag_name %></span><% } %>
            <% if (featured) { %><span class="text-sub"><%= new Date(featured.published_at || featured.created_at).toLocaleDateString() %></span><% } %>
          </div>
          <h2 style="margin:0">
            <a href="/blog/<%= featured?.slug %>"><%= featured?.title %></a>
          </h2>
          <p class="text-sub clamp-3"><%= featured?.excerpt || featured?.summary || '' %></p>
          <div style="margin-top:auto">
            <a class="btn" href="/blog/<%= featured?.slug %>">Read story</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Content + sidebar -->
    <div style="display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start">
      <!-- Grid -->
      <section>
        <% if (!posts || !posts.length) { %>
          <div class="card" style="padding:16px">No articles found.</div>
        <% } else { %>
          <div class="blog-grid">
            <% posts.forEach(p => { %>
              <article class="card blog-card">
                <a class="thumb" href="/blog/<%= p.slug %>">
                  <img src="<%= p.image || '/img/blog-placeholder.jpg' %>"
                       alt="<%= p.title %>"
                       onerror="this.src='/img/blog-placeholder.jpg'">
                </a>
                <div class="card-body">
                  <div class="meta" style="margin-bottom:6px">
                    <% if (p.tag_name) { %><span class="tag"><%= p.tag_name %></span><% } %>
                    <span class="text-sub"><%= new Date(p.published_at || p.created_at).toLocaleDateString() %></span>
                  </div>
                  <h3 style="margin:.1rem 0"><a href="/blog/<%= p.slug %>"><%= p.title %></a></h3>
                  <p class="text-sub clamp-3"><%= p.excerpt || p.summary || '' %></p>
                  <div style="margin-top:10px">
                    <a class="btn-outline" href="/blog/<%= p.slug %>">Read more</a>
                  </div>
                </div>
              </article>
            <% }) %>
          </div>

          <% if (totalPages > 1) { %>
            <nav style="display:flex;gap:8px;align-items:center;justify-content:center;margin-top:18px">
              <% const mk = (n) => `/blog?page=${n}${q?`&q=${encodeURIComponent(q)}`:''}${tag?`&tag=${encodeURIComponent(tag)}`:''}` %>
              <a class="btn-outline" href="<%= mk(Math.max(1, page-1)) %>">&laquo; Prev</a>
              <span class="text-sub">Page <%= page %> / <%= totalPages %></span>
              <a class="btn-outline" href="<%= mk(Math.min(totalPages, page+1)) %>">Next &raquo;</a>
            </nav>
          <% } %>
        <% } %>
      </section>

      <!-- Sidebar -->
      <aside class="blog-sidebar">
        <div class="card" style="padding:16px">
          <h4 style="margin:0 0 8px">About our blog</h4>
          <p class="text-sub">Updates on products, manufacturing, sustainability and company news.</p>
        </div>

        <% if (Array.isArray(recent) && recent.length) { %>
          <div class="card" style="padding:16px;margin-top:12px">
            <h4 style="margin:0 0 8px">Recent posts</h4>
            <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px">
              <% recent.forEach(r => { %>
                <li>
                  <a href="/blog/<%= r.slug %>"><%= r.title %></a>
                  <div class="small text-sub"><%= new Date(r.published_at || r.created_at).toLocaleDateString() %></div>
                </li>
              <% }) %>
            </ul>
          </div>
        <% } %>
      </aside>
    </div>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>
